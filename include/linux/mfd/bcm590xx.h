/* SPDX-License-Identifier: GPL-2.0-or-later */
/*
 * Broadcom BCM590xx PMU
 *
 * Copyright 2014 Linaro Limited
 * Author: Matt Porter <mporter@linaro.org>
 */

#ifndef __LINUX_MFD_BCM590XX_H
#define __LINUX_MFD_BCM590XX_H

#include <linux/device.h>
#include <linux/i2c.h>
#include <linux/regmap.h>

/* device types */
enum bcm590xx_dev_type {
	BCM59054_TYPE,
	BCM59056_TYPE,
	BCM590XX_TYPE_MAX,
};

/* regmap types */
enum bcm590xx_regmap_type {
	BCM590XX_REGMAP_PRI,
	BCM590XX_REGMAP_SEC,
};

/* max register address */
#define BCM590XX_MAX_REGISTER_PRI	0xe7
#define BCM590XX_MAX_REGISTER_SEC	0xf0

struct bcm590xx {
	struct device *dev;
	enum bcm590xx_dev_type dev_type;
	struct i2c_client *i2c_pri;
	struct i2c_client *i2c_sec;
	struct regmap *regmap_pri;
	struct regmap *regmap_sec;
	unsigned int id;

	/* Chip revision, read from PMUREV reg */
	u8 rev_dig;
	u8 rev_ana;

	/* Interrupts */
	int irq;
	struct regmap_irq_chip_data *irq_data;
};

/* Known chip revision IDs */
#define BCM59054_REV_DIG_A1		1
#define BCM59054_REV_ANA_A1		2

#define BCM59056_REV_DIG_A0		1
#define BCM59056_REV_ANA_A0		1

#define BCM59056_REV_DIG_B0		2
#define BCM59056_REV_ANA_B0		2

/* Interrupt handling helper functions */

static inline int
bcm590xx_devm_request_irq(struct device *dev, struct bcm590xx *bcm590xx, int irq,
			  irq_handler_t handler, unsigned long flags,
			  const char *name, void *data)
{
	if (!bcm590xx->irq_data)
		return -EINVAL;

	return devm_request_threaded_irq(dev,
				regmap_irq_get_virq(bcm590xx->irq_data, irq),
				NULL, handler, flags, name, data);
}

static inline void
bcm590xx_devm_free_irq(struct device *dev, struct bcm590xx *bcm590xx, int irq,
		       void *data)
{
	if (!bcm590xx->irq_data)
		return;

	devm_free_irq(dev, regmap_irq_get_virq(bcm590xx->irq_data, irq), data);
}

/* BCM59054 IRQs */

enum bcm59054_irq {
	BCM59054_IRQ_USBINS = 0,
	BCM59054_IRQ_USBRM,
	BCM59054_IRQ_BATINS,
	BCM59054_IRQ_BATRM,
	BCM59054_IRQ_MBC_CV_LOOP,
	BCM59054_IRQ_MBC_CV_TMR_EXP,
	BCM59054_IRQ_EOC,
	BCM59054_IRQ_RESUME_VBUS,
	BCM59054_IRQ_MBTEMPLOW,
	BCM59054_IRQ_MBTEMPHIGH,
	BCM59054_IRQ_USBOV,
	BCM59054_IRQ_MBOV,
	BCM59054_IRQ_CHGERRDIS,
	BCM59054_IRQ_MBOV_DIS,
	BCM59054_IRQ_USBOV_DIS,
	BCM59054_IRQ_MBC_TF,
	BCM59054_IRQ_CHG_HW_TTR_EXP,
	BCM59054_IRQ_CHG_HW_TCH_EXP,
	BCM59054_IRQ_CHG_SW_TMR_EXP,
	BCM59054_IRQ_CHG_TCH_1MIN_BF_EXP,
	BCM59054_IRQ_USB_PORT_DIS,
	BCM59054_IRQ_USB_CC_REDUCE,
	BCM59054_IRQ_VBUSLOWBND,
	BCM59054_IRQ_UBPD_CHG_F,
	BCM59054_IRQ_VBUS_VALID_F,
	BCM59054_IRQ_OTG_SESS_VALID_F,
	BCM59054_IRQ_VB_SESS_END_F,
	BCM59054_IRQ_ID_RM,
	BCM59054_IRQ_VBUS_VALID_R,
	BCM59054_IRQ_VA_SESS_VALID_R,
	BCM59054_IRQ_VB_SESS_END_R,
	BCM59054_IRQ_ID_INS,
	BCM59054_IRQ_IDCHG,
	BCM59054_IRQ_RIC_C_TO_FLOAT,
	BCM59054_IRQ_CHGDET_LATCH,
	BCM59054_IRQ_CHGDET_TO,
	BCM59054_IRQ_ADP_CHANGE,
	BCM59054_IRQ_ADP_SNS_END,
	BCM59054_IRQ_ADP_PROB,
	BCM59054_IRQ_ADP_PRB_ERR,
	BCM59054_IRQ_POK_PRESSED,
	BCM59054_IRQ_POK_RELEASED,
	BCM59054_IRQ_POK_WAKEUP,
	BCM59054_IRQ_POK_BIT_VLD,
	BCM59054_IRQ_POK_RESTART,
	BCM59054_IRQ_POK_T1,
	BCM59054_IRQ_POK_T2,
	BCM59054_IRQ_POK_T3,
	BCM59054_IRQ_I2C_RESTART,
	BCM59054_IRQ_GBAT_PLUG_IN,
	BCM59054_IRQ_SMPL_INT,
	BCM59054_IRQ_AUX_INS,
	BCM59054_IRQ_AUX_RM,
	BCM59054_IRQ_XTAL_FAILURE,
	BCM59054_IRQ_MBWV_R_10S_WAIT,
	BCM59054_IRQ_MBWV_F,
	BCM59054_IRQ_RTC_ALARM,
	BCM59054_IRQ_RTC_SEC,
	BCM59054_IRQ_RTC_MIN,
	BCM59054_IRQ_RTCADJ,
	BCM59054_IRQ_FGC,
	BCM59054_IRQ_BBLOW,
	BCM59054_IRQ_DIE_OT_R,
	BCM59054_IRQ_DIE_OT_F,
	BCM59054_IRQ_RTM_DATA_RDY,
	BCM59054_IRQ_RTM_IN_CON_MEAS,
	BCM59054_IRQ_RTM_UPPER,
	BCM59054_IRQ_RTM_IGNORE,
	BCM59054_IRQ_RTM_OVERRIDDEN,
	BCM59054_IRQ_AUD_HSAB_SHCKT,
	BCM59054_IRQ_AUD_IHFD_SHCKT,
	BCM59054_IRQ_POK_NOP,
	BCM59054_IRQ_MIPI_LEN_ERR,
	BCM59054_IRQ_MIPI_RCV_ERR,
	BCM59054_IRQ_MIPI_BUSQ_RESP,
	BCM59054_IRQ_MIPI_BUSQ_POS,
	BCM59054_IRQ_MIPI_EOT,
	BCM59054_IRQ_MIPI_XMT_END,
	BCM59054_IRQ_MIPI_INT_POS,
	BCM59054_IRQ_LOWBAT,
	BCM59054_IRQ_CSROVRI,
	BCM59054_IRQ_VSROVRI,
	BCM59054_IRQ_MSROVRI,
	BCM59054_IRQ_SDSR1OVRI,
	BCM59054_IRQ_SDSR2OVRI,
	BCM59054_IRQ_IOSR1OVRI,
	BCM59054_IRQ_IOSR2OVRI,
	BCM59054_IRQ_RESERVED,
	BCM59054_IRQ_RFLDO_OVRI,
	BCM59054_IRQ_AUDLDO_OVRI,
	BCM59054_IRQ_USBLDO_OVR,
	BCM59054_IRQ_SDXLDO_OVRI,
	BCM59054_IRQ_MICLDO_OVRI,
	BCM59054_IRQ_SIMLDO1_OVRI,
	BCM59054_IRQ_SIMLDO2_OVRI,
	BCM59054_IRQ_MMCLDO1_OVRI,
	BCM59054_IRQ_CAMLDO1_OVRI,
	BCM59054_IRQ_CAMLDO2_OVRI,
	BCM59054_IRQ_VIBLDO_OVRI,
	BCM59054_IRQ_SDLDO_OVRI,
	BCM59054_IRQ_GPLDO1_OVRI,
	BCM59054_IRQ_GPLDO2_OVRI,
	BCM59054_IRQ_GPLDO3_OVRI,
	BCM59054_IRQ_RFLDO_SHD,
	BCM59054_IRQ_AUDLDO_SHD,
	BCM59054_IRQ_USBLDO_SHD,
	BCM59054_IRQ_SDXLDO_SHD,
	BCM59054_IRQ_MICLDO_SHD,
	BCM59054_IRQ_SIMLDO1_SHD,
	BCM59054_IRQ_SIMLDO2_SHD,
	BCM59054_IRQ_MMCLDO1_SHD,
	BCM59054_IRQ_MMCLDO2_SHD,
	BCM59054_IRQ_CAMLDO1_SHD,
	BCM59054_IRQ_CAMLDO2_SHD,
	BCM59054_IRQ_VIBLDO_SHD,
	BCM59054_IRQ_SDLDO_SHD,
	BCM59054_IRQ_GPLDO1_SHD,
	BCM59054_IRQ_GPLDO2_SHD,
	BCM59054_IRQ_GPLDO3_SHD,
	BCM59054_IRQ_TCXLDO_OVRI,
	BCM59054_IRQ_LVLDO1_OVRI,
	BCM59054_IRQ_LVLDO2_OVRI,
	BCM59054_IRQ_TCXLDO_SHD,
	BCM59054_IRQ_LVLDO1_SHD,
	BCM59054_IRQ_LVLDO2_SHD,
	BCM59054_IRQ_VBOVRV,
	BCM59054_IRQ_VBOVRI,
	BCM59054_IRQ_MAX,
};

/* BCM59056 IRQs */

enum bcm59056_irq {
	BCM59056_IRQ_RTC_ALARM = 0,
	BCM59056_IRQ_RTC_SEC,
	BCM59056_IRQ_RTC_MIN,
	BCM59056_IRQ_RTCADJ,
	BCM59056_IRQ_BATINS,
	BCM59056_IRQ_BATRM,
	BCM59056_IRQ_GBAT_PLUG_IN,
	BCM59056_IRQ_SMPL_INT,
	BCM59056_IRQ_USBINS,
	BCM59056_IRQ_USBRM,
	BCM59056_IRQ_USBOV,
	BCM59056_IRQ_EOC,
	BCM59056_IRQ_RESUME_VBUS,
	BCM59056_IRQ_CHG_HW_TTR_EXP,
	BCM59056_IRQ_CHG_HW_TCH_EXP,
	BCM59056_IRQ_CHG_SW_TMR_EXP,
	BCM59056_IRQ_CHGDET_LATCH,
	BCM59056_IRQ_CHGDET_TO,
	BCM59056_IRQ_MBTEMPLOW,
	BCM59056_IRQ_MBTEMPHIGH,
	BCM59056_IRQ_MBOV,
	BCM59056_IRQ_MBOV_DIS,
	BCM59056_IRQ_USBOV_DIS,
	BCM59056_IRQ_CHGERRDIS,
	BCM59056_IRQ_VBUS_1V5_R,
	BCM59056_IRQ_VBUS_4V5_R,
	BCM59056_IRQ_VBUS_1V5_F,
	BCM59056_IRQ_VBUS_4V5_F,
	BCM59056_IRQ_MBWV_R_10S_WAIT,
	BCM59056_IRQ_BBLOW,
	BCM59056_IRQ_LOWBAT,
	BCM59056_IRQ_VERYLOWBAT,
	BCM59056_IRQ_RTM_DATA_RDY,
	BCM59056_IRQ_RTM_IN_CON_MEAS,
	BCM59056_IRQ_RTM_UPPER,
	BCM59056_IRQ_RTM_IGNORE,
	BCM59056_IRQ_RTM_OVERRIDDEN,
	BCM59056_IRQ_AUD_HSAB_SHCKT,
	BCM59056_IRQ_AUD_IHFD_SHCKT,
	BCM59056_IRQ_MBC_TF,
	BCM59056_IRQ_CSROVRI,
	BCM59056_IRQ_IOSROVRI,
	BCM59056_IRQ_SDSROVRI,
	BCM59056_IRQ_ASROVRI,
	BCM59056_IRQ_UBPD_CHG_F,
	BCM59056_IRQ_ACD_INS,
	BCM59056_IRQ_ACD_RM,
	BCM59056_IRQ_PONKEYB_HOLD,
	BCM59056_IRQ_PONKEYB_F,
	BCM59056_IRQ_PONKEYB_R,
	BCM59056_IRQ_PONKEYB_OFFHOLD,
	BCM59056_IRQ_PONKEYB_RESTART,
	BCM59056_IRQ_IDCHG,
	BCM59056_IRQ_JIG_USB_INS,
	BCM59056_IRQ_UART_INS,
	BCM59056_IRQ_ID_INS,
	BCM59056_IRQ_ID_RM,
	BCM59056_IRQ_ADP_CHANGE,
	BCM59056_IRQ_ADP_SNS_END,
	BCM59056_IRQ_SESSION_END_VLD,
	BCM59056_IRQ_SESSION_END_INVLD,
	BCM59056_IRQ_VBUS_OVERCURRENT,
	BCM59056_IRQ_FGC,
	BCM59056_IRQ_MAX,
};

#endif /*  __LINUX_MFD_BCM590XX_H */
